from langchain_core.prompts import PromptTemplate


# 描述: 带有评分机制的 基本面分析师 Prompt 模板
FUNDAMENTAL_PROMPT = PromptTemplate.from_template(
"""
{role_description}

你的任务是基于最新数据，分析股票 {stock_code} 的基本面，并给出量化评分与投资倾向。

**分析时间段**: {analysis_period}

请使用你可用的工具获取并核实**最新财务数据**，从以下角度进行结构化分析，并为每个维度打分（1-5分）：
**重要提示**：在分析过程中，请充分利用公司基本信息（如所属行业、地区、主营业务等）来增强分析的准确性和深度。
1. **盈利能力**（1=极差，5=极强）：参考营业收入、净利润、毛利率、净利率、ROE、ROA 等指标，评估公司盈利的稳定性与可持续性。结合公司所属行业特点进行分析。
2. **偿债能力**（1=风险极高，5=财务极健康）：参考资产负债率、流动比率、现金流状况，评估公司偿还债务的能力与风险水平。考虑公司规模、行业特征等因素。
3. **增长潜力**（1=无增长或萎缩，5=高速增长）：结合历史增长率、行业趋势、研发投入、市场份额变化，分析公司未来的发展空间。重点关注公司主营业务的发展前景和行业地位。

评分规则：
- **1分**：显著劣势，行业或历史表现均落后
- **2分**：较差，有明显风险或劣势
- **3分**：一般，与行业平均水平相当
- **4分**：良好，高于行业平均，有一定优势
- **5分**：优秀，显著高于行业，具备持续竞争优势

分析完成后，请：
- 给出一个明确的投资立场（仅限"看多"或"看空"），必须基于你的分析与评分结果推导。
- 用一句话（不超过100字）简要概述核心结论与主要理由。
- 详细说明分析过程，分点阐述每个维度的结论、依据与评分。

**财务数据（供参考）**：
{fundamental_data}

**输出格式要求**（严格遵守以下 JSON 结构，不要添加额外字段或注释）：
```json
{{
  "analyst_name": "基本面分析师",
  "viewpoint": "看多 或 看空",
  "reason": "基于对盈利能力、偿债能力和增长潜力的综合评估，得出此结论的核心理由。",
  "scores": {{
    "profitability": 1-5,
    "solvency": 1-5,
    "growth_potential": 1-5
  }},
  "detailed_analysis": "1. **盈利能力 (评分: X/5)**: [此处是详细分析，引用数据证据说明为什么给出这个分数]\n2. **偿债能力 (评分: X/5)**: [此处是详细分析，引用数据证据说明为什么给出这个分数]\n3. **增长潜力 (评分: X/5)**: [此处是详细分析，引用数据证据说明为什么给出这个分数]"
}}
```
"""
)



# 描述: 技术面分析师的Prompt模板。
# -----------------------------------------------------------------

TECHNICAL_PROMPT = PromptTemplate.from_template(
"""
{role_description}

你的任务是分析股票 {stock_code} 的技术面，并给出量化评分与投资倾向。

**分析时间段**: {analysis_period}

请使用你可用的工具获取并核实**最新的行情与技术指标数据**，从以下角度进行结构化分析，并为每个维度打分（1-5分）：

## 分析维度

### 1. **趋势强度**（1=明显下跌，5=强劲上涨）
- **均线系统分析**：评估短期、中期、长期均线的排列状态（多头排列/空头排列/纠缠状态）
- **趋势线分析**：识别上升趋势线、下降趋势线、水平趋势线的有效性
- **价格通道**：分析价格是否在有效的上升或下降通道内运行
- **趋势持续性**：评估当前趋势的强度和持续时间

### 2. **动能与超买超卖**（1=严重超买或超卖信号失效，5=动能强劲且处于健康区间）
- **RSI指标**：分析相对强弱指数的位置和变化趋势
- **MACD指标**：评估MACD线、信号线和柱状图的关系
- **KDJ指标**：分析K、D、J三线的位置关系和金叉死叉信号
- **威廉指标**：评估超买超卖状态
- **动量指标**：分析价格动量的变化

### 3. **关键价位支撑与阻力**（1=已跌破关键支撑，5=稳站关键支撑或突破阻力）
- **历史支撑阻力位**：识别重要的历史高低点
- **心理价位**：分析整数关口、重要心理价位的影响
- **技术形态支撑阻力**：评估头肩顶/底、双顶/底等形态的支撑阻力作用
- **斐波那契回撤位**：分析关键回撤位的支撑阻力效果

### 4. **成交量与市场参与度**（1=成交量极度萎缩，5=成交量健康配合）
- **量价关系**：分析成交量与价格变动的配合程度
- **量能变化**：评估成交量的放大、萎缩趋势
- **资金流向**：分析大单、中单、小单的资金流向
- **换手率**：评估股票的活跃度和市场关注度

### 5. **K线形态与组合**（1=看空形态明显，5=看多形态明确）
- **单根K线形态**：识别锤子线、十字星、流星线等形态
- **K线组合形态**：分析早晨之星、黄昏之星、红三兵等组合
- **持续形态**：识别三角形、旗形、楔形等持续形态
- **反转形态**：分析头肩顶/底、双顶/底、圆弧顶/底等反转形态

## 评分规则
- **1分**：极弱，信号明显看空，技术面极度不利
- **2分**：偏弱，风险较高，技术面偏向看空
- **3分**：中性，信号矛盾或趋势不明，技术面中性
- **4分**：偏强，有利于看多，技术面偏向看多
- **5分**：极强，信号一致看多，技术面极度有利

## 分析要求
1. **数据驱动**：所有分析必须基于具体的技术指标数据
2. **多时间框架**：结合日线、周线、月线等多个时间框架进行分析
3. **形态确认**：重要形态需要成交量等其他指标配合确认
4. **风险提示**：识别技术分析中的假突破、背离等风险信号
5. **趋势一致性**：评估各技术指标之间的一致性和矛盾性

## 输出要求
分析完成后，请：
- 给出一个明确的投资立场（仅限"看多"或"看空"）
- 用一句话（不超过100字）总结核心结论与理由
- 详细说明分析过程，分点阐述每个维度的结论、依据与评分
- 提供具体的操作建议和风险提示

**技术数据（供参考）**：
{tech_data}

**输出格式要求**（严格遵守以下JSON结构）：
```json
{{
  "analyst_name": "技术分析师",
  "viewpoint": "看多 或 看空",
  "reason": "一句话总结核心结论与理由（<=100字）",
  "scores": {{
    "trend_strength": 1-5,
    "momentum": 1-5,
    "support_resistance": 1-5,
    "volume_analysis": 1-5,
    "pattern_analysis": 1-5
  }},
  "detailed_analysis": "分点列出各维度的分析内容、依据与评分，包括：\n1. 趋势强度分析\n2. 动能与超买超卖分析\n3. 支撑阻力位分析\n4. 成交量分析\n5. K线形态分析",
  "risk_warnings": ["风险因素1", "风险因素2", "风险因素3"],
  "operation_suggestions": "具体的操作建议，包括买入/卖出时机、止损止盈位等"
}}
```
"""
)



# 描述: 情绪分析师的Prompt模板。
# -----------------------------------------------------------------
SENTIMENT_PROMPT = PromptTemplate.from_template(
"""
{role_description}

你的任务是分析股票 {stock_code} 的市场情绪，并给出量化评分与投资倾向。

**分析时间段**: {analysis_period}

请使用你可用的工具获取并核实**最新的市场情绪数据**（包括社交媒体、新闻热度、机构观点等），从以下角度进行结构化分析，并为每个维度打分（1-5分）：
1. **市场热度**（1=冷清，5=极度关注）：评估搜索量、讨论度、交易活跃度等。
2. **投资者情绪**（1=恐慌，5=强烈乐观）：参考社交媒体、论坛、评论情绪分析等。
3. **机构与主流观点**（1=普遍看空，5=普遍看多）：统计机构研报与知名分析师观点的方向。

评分规则：
- 1分：极度负面，情绪一致看空
- 2分：偏负面，情绪风险高
- 3分：中性，意见分歧
- 4分：偏正面，有助于上涨
- 5分：极度正面，情绪一致看多

分析完成后，请：
- 给出一个明确的投资立场（仅限"看多"或"看空"）。
- 用一句话（不超过100字）总结核心结论与理由。
- 详细说明分析过程，分点阐述每个维度的结论、依据与评分。

**情绪数据（供参考）**：
{sentiment_data}

**输出格式要求**：
```json
{{
  "analyst_name": "情绪分析师",
  "viewpoint": "看多 或 看空",
  "reason": "一句话总结核心结论与理由（<=100字）",
  "scores": {{
    "market_heat": 1-5,
    "investor_sentiment": 1-5,
    "institution_opinion": 1-5
  }},
  "detailed_analysis": "分点列出市场热度、投资者情绪、机构观点的分析内容、依据与评分。"
}}
"""
)

# 描述: 资金分析师的Prompt模板。
# -----------------------------------------------------------------
FUND_PROMPT = PromptTemplate.from_template(
"""
{role_description}

你的任务是分析股票 {stock_code} 的资金流向，并给出量化评分与投资倾向。

**分析时间段**: {analysis_period}

请使用你可用的工具获取并核实**最新的资金流向数据**（包括主力、机构、散户等），从以下角度进行结构化分析，并为每个维度打分（1-5分）：
1. **主力资金动向**（1=持续流出，5=持续流入）：大单交易、北向资金等。
2. **机构资金趋势**（1=明显减仓，5=明显加仓）：基金、保险、QFII 等机构持仓变动。
3. **散户资金参与度**（1=情绪化追高杀跌，5=理性且配合主力趋势）：评估成交量与资金分布。

评分规则：
- 1分：极度看空，资金持续流出
- 2分：偏空，流出大于流入
- 3分：中性，资金变化不明显
- 4分：偏多，资金流入占优
- 5分：极度看多，资金大幅流入

分析完成后，请：
- 给出一个明确的投资立场（仅限"看多"或"看空"）。
- 用一句话（不超过100字）总结核心结论与理由。
- 详细说明分析过程，分点阐述每个维度的结论、依据与评分。

**资金数据（供参考）**：
{fund_data}

**输出格式要求**：
```json
{{
  "analyst_name": "资金分析师",
  "viewpoint": "看多 或 看空",
  "reason": "一句话总结核心结论与理由（<=100字）",
  "scores": {{
    "main_capital": 1-5,
    "institution_capital": 1-5,
    "retail_capital": 1-5
  }},
  "detailed_analysis": "分点列出主力资金、机构资金、散户资金的分析内容、依据与评分。"
}}
"""
)


# 描述：新闻分析师的Prompt模板。
# -----------------------------------------------------------------
NEWS_PROMPT = PromptTemplate.from_template(
"""
{role_description}

你的任务是分析股票 {stock_code} 的舆情与新闻，并给出量化评分与投资倾向。

**分析时间段**: {analysis_period}

**重要说明（请严格遵守）**：
- 下面提供的 `news_data` 是**结构化 JSON（字符串）**，请**先解析为JSON对象**再进行分析；**禁止**编造不存在的字段或事实。
请基于以下新闻数据进行分析：

**新闻数据**：
{news_data}

分析完成后，请：
- 给出一个明确的投资立场（仅限"看多"或"看空"）。
- 用一句话（不超过100字）总结核心结论与理由。
- 详细说明分析过程，分点阐述每个维度的结论、依据与评分。

**输出格式要求**：
```json
{{
  "analyst_name": "新闻分析师",
  "viewpoint": "看多 或 看空",
  "reason": "一句话总结核心结论与理由（<=100字）",
  "scores": {{
    "sentiment_score": 1-5,
    "news_impact": 1-5,
    "market_attention": 1-5
  }},
  "detailed_analysis": "分点列出情绪分析、新闻影响、市场关注度的分析内容、依据与评分。"
}}
```
"""
)